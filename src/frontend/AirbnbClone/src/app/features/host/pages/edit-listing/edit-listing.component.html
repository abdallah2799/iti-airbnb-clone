<div class="min-h-screen bg-gray-50 pb-20">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <div class="bg-white border-b border-gray-200 sticky top-0 z-20">
    <div class="max-w-3xl mx-auto px-6 h-20 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <button
          [routerLink]="['/my-listings', listingId]"
          class="p-2 hover:bg-gray-100 rounded-full transition-colors"
        >
          <lucide-icon [img]="icons.ChevronLeft" [size]="20"></lucide-icon>
        </button>
        <h1 class="text-xl font-bold text-[#222222]">Edit Listing</h1>
      </div>

      <button
        (click)="onSave()"
        [disabled]="isSaving || isLoading"
        class="flex items-center gap-2 px-6 py-2 bg-black text-white rounded-lg hover:bg-gray-800 transition-colors disabled:opacity-50"
      >
        <lucide-icon *ngIf="!isSaving" [img]="icons.Save" [size]="18"></lucide-icon>
        <lucide-icon
          *ngIf="isSaving"
          [img]="icons.Loader2"
          class="animate-spin w-4 h-4"
        ></lucide-icon>
        <span>{{ isSaving ? 'Saving...' : 'Save' }}</span>
      </button>
    </div>
  </div>

  <div *ngIf="isLoading" class="flex justify-center pt-20">
    <lucide-icon [img]="icons.Loader2" class="animate-spin w-8 h-8 text-[#FF385C]"></lucide-icon>
  </div>

  <div *ngIf="!isLoading" class="max-w-3xl mx-auto px-6 py-8 space-y-6">
    <div class="bg-white rounded-xl border border-gray-200 p-6 shadow-sm space-y-6">
      <h2 class="text-lg font-semibold border-b border-gray-100 pb-2">Basics</h2>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Title</label>
        <input
          type="text"
          [(ngModel)]="formData.title"
          class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black focus:outline-none"
        />
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
        <textarea
          rows="5"
          [(ngModel)]="formData.description"
          class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black focus:outline-none"
        ></textarea>
      </div>
    </div>

    <div class="bg-white rounded-xl border border-gray-200 p-6 shadow-sm space-y-6">
      <h2 class="text-lg font-semibold border-b border-gray-100 pb-2">Property Details</h2>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Price per night ($)</label>
          <input
            type="number"
            [(ngModel)]="formData.pricePerNight"
            class="w-full p-3 border border-gray-300 rounded-lg"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Property Type</label>
          <select
            [(ngModel)]="formData.propertyType"
            class="w-full p-3 border border-gray-300 rounded-lg bg-white"
          >
            <option *ngFor="let type of propertyTypes" [value]="type.value">
              {{ type.label }}
            </option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Privacy Type</label>
          <select
            [(ngModel)]="formData.privacyType"
            class="w-full p-3 border border-gray-300 rounded-lg bg-white"
          >
            <option *ngFor="let type of privacyTypes" [value]="type.value">{{ type.label }}</option>
          </select>
        </div>
      </div>

      <div class="grid grid-cols-3 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Guests</label>
          <input
            type="number"
            [(ngModel)]="formData.maxGuests"
            class="w-full p-3 border border-gray-300 rounded-lg"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Bedrooms</label>
          <input
            type="number"
            [(ngModel)]="formData.numberOfBedrooms"
            class="w-full p-3 border border-gray-300 rounded-lg"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Bathrooms</label>
          <input
            type="number"
            [(ngModel)]="formData.numberOfBathrooms"
            class="w-full p-3 border border-gray-300 rounded-lg"
          />
        </div>
      </div>

      <div class="flex items-center gap-2 mt-2">
        <input
          type="checkbox"
          [(ngModel)]="formData.instantBooking"
          id="instant"
          class="w-5 h-5 rounded border-gray-300 text-black focus:ring-black"
        />
        <label for="instant" class="text-sm font-medium text-gray-700">Allow Instant Booking</label>
      </div>
    </div>

    <div class="bg-white rounded-xl border border-gray-200 p-6 shadow-sm space-y-6">
      <h2 class="text-lg font-semibold border-b border-gray-100 pb-2">Location</h2>

      <p class="text-sm text-gray-500">
        Enter address and press <strong>Enter</strong> to search, or drag the pin.
      </p>

      <div class="relative">
        <label class="block text-sm font-medium text-gray-700 mb-1">Address</label>
        <div class="relative mb-6 z-10">
          <div class="absolute inset-y-0 left-0 flex items-center pl-4 pointer-events-none">
            <lucide-icon [img]="icons.MapPin" [size]="20" class="text-gray-500"></lucide-icon>
          </div>

          <input
            type="text"
            [(ngModel)]="formData.address"
            (keydown.enter)="$event.preventDefault(); onAddressSearch()"
            (blur)="onAddressSearch()"
            placeholder="Enter your address (e.g. 123 Main St, New York)"
            class="w-full p-4 pl-12 pr-40 border border-gray-400 rounded-full focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent text-lg shadow-sm"
          />

          <div class="absolute inset-y-0 right-2 flex items-center">
            <button
              (click)="useCurrentLocation()"
              [disabled]="isLocating"
              class="flex items-center gap-2 px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm font-semibold text-gray-700 transition-colors disabled:opacity-50"
            >
              <lucide-icon *ngIf="!isLocating" [img]="icons.LocateFixed" [size]="14"></lucide-icon>
              <lucide-icon
                *ngIf="isLocating"
                [img]="icons.Loader2"
                class="animate-spin"
                [size]="14"
              ></lucide-icon>
              {{ isLocating ? 'Locating...' : 'Current location' }}
            </button>
          </div>
        </div>
      </div>

      <div
        class="bg-gray-100 rounded-xl overflow-hidden shadow-inner border border-gray-200 z-0 relative"
      >
        <div #mapContainer class="map-wrapper"></div>
      </div>

      <div class="grid grid-cols-2 gap-4 bg-gray-50 p-4 rounded-lg">
        <div>
          <label class="block text-xs font-semibold text-gray-500 uppercase">City</label>
          <div class="text-gray-900 font-medium">{{ formData.city || 'Not set' }}</div>
        </div>
        <div>
          <label class="block text-xs font-semibold text-gray-500 uppercase">Country</label>
          <div class="text-gray-900 font-medium">{{ formData.country || 'Not set' }}</div>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-xl border border-gray-200 p-6 shadow-sm space-y-6">
      <h2 class="text-lg font-semibold border-b border-gray-100 pb-2">Amenities</h2>

      <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
        <div
          *ngFor="let amenity of availableAmenities"
          (click)="toggleAmenity(amenity.id)"
          class="p-3 border rounded-lg cursor-pointer flex items-center gap-3 transition-all select-none"
          [ngClass]="
            hasAmenity(amenity.id)
              ? 'border-black bg-gray-50 ring-1 ring-black'
              : 'border-gray-200 hover:border-gray-400'
          "
        >
          <div
            class="w-5 h-5 rounded border flex items-center justify-center flex-shrink-0"
            [ngClass]="
              hasAmenity(amenity.id) ? 'bg-black border-black' : 'border-gray-300 bg-white'
            "
          >
            <lucide-icon
              *ngIf="hasAmenity(amenity.id)"
              [img]="icons.Check"
              [size]="14"
              class="text-white"
            ></lucide-icon>
          </div>
          <span class="text-sm text-[#222222]">{{ amenity.name }}</span>
        </div>
      </div>
    </div>
  </div>
</div>
