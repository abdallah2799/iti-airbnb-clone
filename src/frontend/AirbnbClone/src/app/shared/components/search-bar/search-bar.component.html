<div class="w-full py-3 bg-white">
  <div class="mx-auto max-w-[850px] px-6">
    <div
      class="relative flex items-center bg-white border border-gray-200 rounded-full shadow-[0_3px_12px_0_rgba(0,0,0,0.1)] hover:shadow-[0_2px_4px_0_rgba(0,0,0,0.12)] transition-all duration-200 h-[66px]"
    >
      <div class="flex-1 relative h-full group">
        <button
          (click)="setActiveField('location')"
          [class.bg-white]="activeField === 'location'"
          [class.shadow-lg]="activeField === 'location'"
          [class.hover:bg-[#EBEBEB]]="activeField !== 'location'"
          class="w-full h-full text-left px-8 rounded-full transition-all duration-200 relative z-10 flex flex-col justify-center outline-none"
        >
          <div class="text-[12px] font-bold text-gray-800 tracking-wide">Where</div>
          <div
            class="text-[14px] text-gray-600 truncate font-medium overflow-hidden text-ellipsis whitespace-nowrap"
          >
            {{ searchData.location || 'Search destinations' }}
          </div>
        </button>

        <div
          *ngIf="activeField === 'location'"
          class="absolute top-full left-0 mt-4 w-[350px] bg-white rounded-[32px] shadow-[0_6px_20px_rgba(0,0,0,0.2)] border border-gray-100 overflow-hidden z-50 p-6 animate-fadeIn"
        >
          <div class="mb-4">
            <input
              type="text"
              placeholder="Search destinations"
              (input)="onLocationSearchInput($event)"
              class="w-full bg-[#F7F7F7] px-4 py-4 rounded-xl text-gray-800 font-medium text-lg placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-900 border-none"
              autofocus
            />
          </div>

          <div *ngIf="isLoadingLocations" class="py-8 text-center">
            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900 mx-auto"></div>
          </div>

          <div *ngIf="!isLoadingLocations" class="max-h-[300px] overflow-y-auto custom-scrollbar">
            <div
              *ngFor="let location of filteredLocations"
              (click)="selectDestination(location)"
              class="flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg cursor-pointer transition-colors mb-1"
            >
              <div class="flex items-center gap-4 min-w-0">
                <div
                  class="w-12 h-12 bg-[#F1F1F1] rounded-xl flex items-center justify-center text-lg flex-shrink-0"
                >
                  üìç
                </div>
                <div class="min-w-0">
                  <div class="font-medium text-gray-900 text-[15px]">{{ location.city }}</div>
                  <div class="text-sm text-gray-500">{{ location.country }}</div>
                </div>
              </div>

              <div class="text-xs text-gray-400 whitespace-nowrap ml-2">
                {{ location.listingCount }} stay{{ location.listingCount !== 1 ? 's' : '' }}
              </div>
            </div>
            <div *ngIf="filteredLocations.length === 0" class="text-gray-500 text-sm py-2">
              No results found
            </div>
          </div>
        </div>
      </div>

      <div
        class="w-[1px] h-8 bg-gray-300 absolute left-[28%] z-0 transition-opacity duration-200"
        [class.opacity-0]="
          activeField === 'location' ||
          activeField === 'checkIn' ||
          hoverField === 'location' ||
          hoverField === 'checkIn'
        "
      ></div>

      <div
        class="flex-1 relative h-full group"
        (mouseenter)="hoverField = 'checkIn'"
        (mouseleave)="hoverField = null"
      >
        <div class="h-full w-full relative z-10">
          <div
            [class.bg-white]="activeField === 'checkIn'"
            [class.shadow-lg]="activeField === 'checkIn'"
            [class.hover:bg-[#EBEBEB]]="activeField !== 'checkIn'"
            class="h-full rounded-full px-6 flex flex-col justify-center transition-all duration-200 cursor-pointer"
          >
            <label class="text-[12px] font-bold text-gray-800 tracking-wide block cursor-pointer"
              >Check in</label
            >
            <input
              type="date"
              [(ngModel)]="searchData.checkIn"
              [min]="getTodayDate()"
              (focus)="setActiveField('checkIn')"
              class="text-[14px] text-gray-600 bg-transparent border-none outline-none p-0 w-full font-medium cursor-pointer placeholder-gray-400 font-sans"
              placeholder="Add dates"
            />
          </div>
        </div>
      </div>

      <div
        class="w-[1px] h-8 bg-gray-300 absolute left-[52%] z-0 transition-opacity duration-200"
        [class.opacity-0]="
          activeField === 'checkIn' ||
          activeField === 'checkOut' ||
          hoverField === 'checkIn' ||
          hoverField === 'checkOut'
        "
      ></div>

      <div
        class="flex-1 relative h-full group"
        (mouseenter)="hoverField = 'checkOut'"
        (mouseleave)="hoverField = null"
      >
        <div class="h-full w-full relative z-10">
          <div
            [class.bg-white]="activeField === 'checkOut'"
            [class.shadow-lg]="activeField === 'checkOut'"
            [class.hover:bg-[#EBEBEB]]="activeField !== 'checkOut'"
            class="h-full rounded-full px-6 flex flex-col justify-center transition-all duration-200 cursor-pointer"
          >
            <label class="text-[12px] font-bold text-gray-800 tracking-wide block cursor-pointer"
              >Check out</label
            >
            <input
              type="date"
              [(ngModel)]="searchData.checkOut"
              [min]="searchData.checkIn || getTodayDate()"
              (focus)="setActiveField('checkOut')"
              class="text-[14px] text-gray-600 bg-transparent border-none outline-none p-0 w-full font-medium cursor-pointer placeholder-gray-400 font-sans"
              placeholder="Add dates"
            />
          </div>
        </div>
      </div>

      <div
        class="w-[1px] h-8 bg-gray-300 absolute left-[75%] z-0 transition-opacity duration-200"
        [class.opacity-0]="
          activeField === 'checkOut' ||
          activeField === 'guests' ||
          hoverField === 'checkOut' ||
          hoverField === 'guests'
        "
      ></div>

      <div class="flex-[1.3] relative h-full group flex items-center pr-2">
        <button
          (click)="setActiveField('guests')"
          [class.bg-white]="activeField === 'guests'"
          [class.shadow-lg]="activeField === 'guests'"
          [class.hover:bg-[#EBEBEB]]="activeField !== 'guests'"
          class="flex-1 h-full text-left px-6 rounded-full transition-all duration-200 relative z-10 flex flex-col justify-center outline-none"
        >
          <div class="text-[12px] font-bold text-gray-800 tracking-wide">Who</div>
          <div
            class="text-[14px] font-medium"
            [class.text-gray-600]="getGuestText()"
            [class.text-gray-400]="!getGuestText()"
          >
            {{ getGuestText() || 'Add guests' }}
          </div>
        </button>

        <div
          *ngIf="activeField === 'guests'"
          class="absolute top-full right-0 mt-4 w-[400px] bg-white rounded-[32px] shadow-[0_6px_20px_rgba(0,0,0,0.2)] border border-gray-100 p-8 z-50 animate-fadeIn cursor-default"
        >
          <div class="space-y-6">
            <div
              *ngFor="let option of guestOptions"
              class="flex items-center justify-between pb-6 border-b border-gray-100 last:border-0 last:pb-0"
            >
              <div>
                <div class="font-bold text-gray-900 text-base">{{ option.type }}</div>
                <div class="text-sm text-gray-500 mt-1">{{ option.description }}</div>
              </div>
              <div class="flex items-center gap-4">
                <button
                  (click)="updateGuestCount(option.type, false); $event.stopPropagation()"
                  [disabled]="option.count === 0"
                  class="w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center text-gray-500 hover:border-black hover:text-black transition-all disabled:opacity-30 disabled:hover:border-gray-300 disabled:cursor-not-allowed"
                >
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2.5"
                      d="M20 12H4"
                    ></path>
                  </svg>
                </button>
                <span class="w-6 text-center text-gray-900 font-medium text-base">{{
                  option.count
                }}</span>
                <button
                  (click)="updateGuestCount(option.type, true); $event.stopPropagation()"
                  class="w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center text-gray-500 hover:border-black hover:text-black transition-all"
                >
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2.5"
                      d="M12 4v16m8-8H4"
                    ></path>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>

        <button
          (click)="search()"
          class="flex items-center justify-center bg-gradient-to-r from-[#FF385C] to-[#E31C5F] hover:from-[#E31C5F] hover:to-[#D1114F] transition-all duration-300 rounded-full shadow-md z-20 cursor-pointer relative ml-2"
          [class.w-[120px]]="activeField"
          [class.w-[48px]]="!activeField"
          [class.h-[48px]]="true"
        >
          <svg
            class="w-4 h-4 text-white font-bold"
            stroke-width="3"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
            ></path>
          </svg>

          <span
            class="text-white text-base font-bold whitespace-nowrap overflow-hidden transition-all duration-300"
            [class.w-auto]="activeField"
            [class.ml-2]="activeField"
            [class.w-0]="!activeField"
            [class.opacity-100]="activeField"
            [class.opacity-0]="!activeField"
          >
            Search
          </span>
        </button>
      </div>
    </div>
  </div>

  <div
    *ngIf="activeField"
    (click)="closeAllFields()"
    class="fixed inset-0 z-0 bg-black/25 transition-opacity"
  ></div>
</div>
